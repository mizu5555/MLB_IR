# Week 4 Phase 1: 資料集擴充執行指南

## 📋 **總覽**

**目標：** 將資料集從 2023-2024 擴充到 2022-2025

**預期效果：**
- 資料量：3,023 筆 → 6,000-8,000 筆
- 賽季範圍：2 年 → 4 年
- 系統程式碼：**不需要改動**（架構已支援多年份）

---

## ✅ **需要更改的文件分析**

### **需要更改（2 個文件）：**

| 文件 | 改動類型 | 必要性 |
|------|---------|--------|
| 數據收集腳本 | 改 `SEASONS = [2022, 2023, 2024, 2025]` | **必須** |
| 向量資料庫 | 重新建立 | **必須** |

### **不需要更改（所有系統文件）：**

✅ `week2_query_classifier.py` - Query 分類器  
✅ `week2_smart_router.py` - 智能路由器  
✅ `week2_mlb_assistant.py` - 主系統  
✅ `week2_streamlit_demo.py` - Web UI  
✅ `week3_evaluation.py` - 評估系統

**原因：** 你的資料庫 schema 已經有 `season` 欄位，系統設計就支援多年份！

---

## 🚀 **執行步驟**

### **Step 1: 數據收集（15-20 分鐘）**

```bash
# 執行擴充版數據收集
python week4_data_collection.py
```

**預期輸出：**
```
MLB 資料收集系統 v2.0 (Week 4 擴充版)
目標賽季：[2022, 2023, 2024, 2025]

[Step 2] 取得打者數據...
  ✅ 2022: ~1400 位打者
  ✅ 2023: ~1500 位打者
  ✅ 2024: ~1500 位打者
  ⚠️  2025: （可能失敗或數據不完整）

[Step 3] 取得投手數據...
  ✅ 2022: ~800 位投手
  ✅ 2023: ~850 位投手
  ✅ 2024: ~850 位投手
  ⚠️  2025: （可能失敗或數據不完整）

✨ 數據收集完成！
總計：6000-8000 筆文檔
```

**注意：**
- 如果 2025 賽季數據失敗，這是正常的（可能賽季未完整）
- 系統會自動跳過失敗的年份
- 至少會有 2022-2024 的數據（這已經足夠）

---

### **Step 2: 重建向量資料庫（5-10 分鐘）**

```bash
# 刪除舊資料庫並重建
python week4_build_vector_db.py
```

**預期輸出：**
```
Week 4: 向量資料庫重建

[Step 1] 載入數據...
✅ 載入 6000+ 筆文檔

📊 數據分布：
  2022: ~2000 筆
  2023: ~2100 筆
  2024: ~2100 筆
  (2025: 可能0筆，如果收集失敗)

[Step 2] 刪除舊的向量資料庫...
✅ 已刪除舊資料庫

[Step 5] 建立 Embeddings...
  （這可能需要 5-10 分鐘）
  [進度條顯示]
✅ Embeddings 生成完成

[Step 6] 建立 LanceDB 向量資料庫...
✅ 表格建立完成

[Step 8] 驗證資料庫...
  ✅ 'Aaron Judge' → Aaron Judge (NYY, 2024)
  ✅ 'Shohei Ohtani' → Shohei Ohtani (LAD, 2024)
  ✅ 'Juan Soto' → Juan Soto (NYY, 2024)

✨ 向量資料庫重建完成！
```

---

### **Step 3: 測試系統（2 分鐘）**

```bash
# 測試主系統
python week2_mlb_assistant.py
```

**測試查詢：**
```python
# 測試不同年份的查詢
queries = [
    "Aaron Judge 2024 wRC+",  # 最新年份
    "Aaron Judge 2022 wRC+",  # 較早年份（如果有收集到）
    "Who has the highest wRC+ in 2023?",  # 特定年份排名
]
```

**預期：** 所有查詢都應該正常運作，找到對應年份的數據

---

### **Step 4: 啟動 Demo 驗證（2 分鐘）**

```bash
# 啟動 Streamlit Demo
streamlit run week2_streamlit_demo.py
```

**測試：**
- 查詢 2022 年的球員
- 查詢 2023 年的球員
- 查詢 2024 年的球員
- 確認都能正常運作

---

## 📊 **預期資料量對比**

| 項目 | Week 3 | Week 4 Phase 1 | 增長 |
|------|--------|---------------|------|
| **賽季範圍** | 2023-2024 | 2022-2025 | 2年 → 4年 |
| **資料筆數** | 3,023 | 6,000-8,000 | +2倍 |
| **打者記錄** | ~1,500 | ~4,000-5,000 | +2倍 |
| **投手記錄** | ~1,500 | ~2,500-3,000 | +2倍 |
| **Vector DB 大小** | ~200 MB | ~400-500 MB | +2倍 |

---

## ⚠️ **常見問題**

### **Q1: 2025 年數據收集失敗怎麼辦？**

**A:** 這是正常的！2025 賽季可能還沒開始或數據不完整。

**解決方案：**
```python
# 在 week4_data_collection.py 中改為
SEASONS = [2022, 2023, 2024]  # 移除 2025

# 或者保持原樣，系統會自動跳過失敗的年份
```

---

### **Q2: 資料收集太慢怎麼辦？**

**A:** pybaseball 有快取機制，第二次執行會快很多。

**加速技巧：**
```python
# 在腳本開頭加入
import pybaseball as pyb
pyb.cache.enable()  # 啟用快取
```

---

### **Q3: 向量資料庫重建失敗？**

**A:** 可能是記憶體不足或套件問題。

**解決方案：**
```bash
# 1. 確保有足夠記憶體（建議 8GB+）
# 2. 重新安裝套件
pip install lancedb sentence-transformers --break-system-packages --upgrade

# 3. 如果還是失敗，分批建立
# 可以先只建 2022-2023，再建 2024
```

---

### **Q4: 系統程式碼需要改動嗎？**

**A:** **不需要！** 你的系統架構已經支援多年份。

**驗證：**
- 資料庫有 `season` 欄位 ✅
- Query 分類器與年份無關 ✅
- 智能路由與年份無關 ✅
- LLM 回答生成與年份無關 ✅

唯一可能需要的：
- 測試集更新（可選）：加入不同年份的測試查詢

---

## 🎯 **Phase 1 完成檢查清單**

執行完 Step 1-4 後，確認以下項目：

- [ ] 數據收集成功（6000+ 筆文檔）
- [ ] 向量資料庫重建成功
- [ ] 測試查詢能找到不同年份的球員
- [ ] Demo 正常運作
- [ ] 各年份數據都存在

**全部打勾？恭喜！Phase 1 完成！** ✅

---

## 📈 **下一步：Week 4 Phase 2-4**

### **Phase 2: 獎項數據整合** 🏆
- 爬取 Baseball Reference 獎項數據
- MVP、新人王、金手套、銀棒獎、全明星

### **Phase 3: 合約/年薪數據整合** 💰
- 爬取 Spotrac 合約數據
- 年薪、合約年限、球隊薪資空間

### **Phase 4: 進階指標整合** 📊
- Statcast 進階數據
- Exit Velocity、Launch Angle、Sprint Speed

---

## 🎉 **總結**

**好消息：**
✅ 系統架構已經支援多年份
✅ 不需要改動核心程式碼
✅ 只需要重新收集數據和重建向量資料庫

**執行時間：**
- 數據收集：15-20 分鐘
- 向量資料庫重建：5-10 分鐘
- **總計：20-30 分鐘**

**完成 Phase 1 後，你的系統就能查詢 2022-2025 的數據了！** 🚀

---

**準備好了嗎？執行 `python week4_data_collection.py` 開始吧！** 💪
